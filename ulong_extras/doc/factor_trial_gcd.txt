/*============================================================================

    Copyright (C) 2009 William Hart

    This file is part of FLINT.

    FLINT is free software; you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation; either version 2 of the License, or
    (at your option) any later version.

    FLINT is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with FLINT; if not, write to the Free Software
    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA

===============================================================================*/

mp_limb_t n_factor_trial_gcd(n_factor_t * factors, mp_limb_t n)

   Does some factoring of n using trial division and by taking the
   gcd of n with a large product of primes. Specifically, {prime_prod,
   prime_prod_n} is an mpn containing the product of the first 
   FLINT_NUM_FACTOR_GCD_PRIMES primes. 

   One requires an initialised n_factor_t structure. Use the
   function n_factor_init defined in ulong_extras for this. 

   The routine starts by doing ordinary trial factoring up to some limit,
   currently 200 primes, then it reduces the enormous prime_prod mod n
   and takes a gcd. If the gcd is prime, that highest power of that 
   factor is removed from n and is added to the factor list and the 
   function returns. One hopes this is the generic case. There is no point 
   doing further trial division because one is assured no further primes 
   up to the FLINT_FACTOR_GCD_LIMIT divide n. 

   If the cofactor is prime instead, this is added to the list. But one
   now knows that the factor found by gcd is a product of primes up to 
   FLINT_FACTOR_GCD_LIMIT. At least some of these are found by 
   trial further trial division up to FLINT_NUM_FACTOR_GCD_PRIMES/3 
   primes (trial division up to the full limit being considered not
   practical).

   Finally, we may now have only a prime left, but the cofactor is 
   returned leaving the calling code to check this.